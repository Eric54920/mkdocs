---
comments: true
---

在Python中，生成器（Generator）是一种特殊的迭代器，它可以在需要时生成值，并且只能迭代一次。生成器函数是使用 `yield` 关键字来定义的，它们会在每次调用时生成（或 `yield`）一个值，并暂停执行，直到下一次调用。

生成器的主要优点是可以节省内存空间，因为它们不会一次性生成所有的值，而是按需生成和返回每个值。这使得生成器非常适合处理大数据集或者无限序列，同时保持代码简洁和高效。

### 1. 创建生成器函数

生成器函数使用 `yield` 关键字来生成值。每次调用生成器的 `__next__()` 方法（或者使用内置的 `next()` 函数）时，生成器会执行，直到遇到 `yield` 来产生值，并将控制权返回给调用者。

#### 示例：

```python
def my_generator():
    yield 1
    yield 2
    yield 3

# 创建生成器对象
gen = my_generator()

# 通过迭代器协议遍历生成器对象
print(next(gen))  # 输出: 1
print(next(gen))  # 输出: 2
print(next(gen))  # 输出: 3

# 再次调用会触发 StopIteration 异常
print(next(gen))  # 抛出 StopIteration 异常
```

### 2. 使用生成器表达式

除了生成器函数外，还可以使用生成器表达式来创建生成器对象，类似于列表推导式。

#### 示例：

```python
# 使用生成器表达式创建生成器对象
gen = (x*x for x in range(1, 4))

# 遍历生成器对象
print(next(gen))  # 输出: 1
print(next(gen))  # 输出: 4
print(next(gen))  # 输出: 9

# 再次调用会触发 StopIteration 异常
print(next(gen))  # 抛出 StopIteration 异常
```

### 3. 生成器的特点

- **惰性计算**：生成器会按需生成值，每次生成一个，不会一次性生成所有值。
- **节省内存**：由于不需要将所有值保存在内存中，生成器通常比完整的列表或集合更节省空间。
- **一次性迭代**：生成器只能迭代一次，因为它们在生成完最后一个值后会抛出 `StopIteration` 异常。

### 4. 生成器的应用场景

- **处理大数据集**：适合处理大文件或数据库查询结果，避免一次性加载所有数据。
- **无限序列**：生成素数、斐波那契数列等无限序列。
- **流式处理**：通过生成器实现流式处理，例如处理网络数据流或日志文件。

### 5. 使用生成器的注意事项

- **只能迭代一次**：生成器只能在第一次迭代时产生值，并且没有办法重新启动或者重置。
- **异常处理**：要注意处理 `StopIteration` 异常，以避免意外中断程序。
- **yield from**：Python 3.3 引入的 `yield from` 语法可以简化生成器中的嵌套和委派生成器。

生成器是Python中功能强大且高效的工具，可以帮助解决许多需要按需生成值或处理大数据集的问题。通过了解生成器的原理和使用方法，可以更好地利用它们来提高代码的性能和可读性。